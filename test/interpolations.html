<!DOCTYPE html>
<html>
    <head>
        <title>Interpolator test</title>
        <style>
            body { font-family: monospace; }
            table, th, td { border: 1px solid black; border-collapse: collapse; padding: 10px; white-space: pre; }
        </style>
    </head>
    <body>
        <h1>Interpolator Test</h1>
        <p><input id="input"></input> <button id="run">Test it</button></p>
        <table>
            <thead>
                <tr>
                    <th>Input</th>
                    <th>Output</th>
                </tr>
            </thead>
            <tbody id="out"></tbody>
        </table>
        <script src="../js/interpol.js"></script>
        <script>
            const box = document.getElementById('input');
            const btn = document.getElementById('run');
            const out = document.getElementById('out');
            function appendResult(input, output, isError) {
                var row = document.createElement('tr');
                var inD = document.createElement('td');
                var ouD = document.createElement('td');
                inD.textContent = input;
                if (isError) {
                    ouD.textContent = 'Error: ' + output;
                    ouD.setAttribute('style', 'color:red');
                } else {
                    ouD.textContent = output;
                }
                row.appendChild(inD);
                row.appendChild(ouD);
                out.appendChild(row);
            }
            function runTest(x) {
                var input, output;
                if (x) {
                    input = x;
                }
                else {
                    input = box.value;
                    box.value = '';
                }
                if (!input) return;
                try {
                    appendResult(input, processExpressions(input, {}), false);
                } catch(e) {
                    appendResult(input, e.toString(), true);
                }
            }
            btn.addEventListener('click', () => runTest());
            
            [
                'nothing here',
                'should not change or cause a syntax error: "{({)"\'"]$[',
                'no $(change) outside of expression',
                'multiple $(123) interspersed $(123) interpolations',
                'multiple items\nconcatenate with spaces:   $(123 456 789)',
                'random:                    $(0 ?? 1000)',
                'ternary true test:         $("OK" if 1 else "Fail")',
                'ternary false test:        $("Fail" if 0 else "OK")',
                'equals test:               $("OK" if 1 == 1 else "Fail")',
                'modulo:                    $("OK" if 10 % 3 == 1 else "Fail")',
                'add:                       $("OK" if 1 + 1 == 2 else "Fail")',
                'add strings:               $("OK" if "Foo" + "bar" == "Foobar" else "Fail")',
                'multiply strings:          $("OK" if "Foo" * 3 == "FooFooFoo" else "Fail")',
                'subtract:                  $("OK" if 10 - 7 == 3 else "Fail")',
                'divide:                    $("OK" if 10 / 5 == 2 else "Fail")',
                'bitwise and:               $("OK" if 14 & 3 == 2 else "Fail")',
                'bitwise or:                $("OK" if 14 | 3 == 15 else "Fail")',
                '$("-" * 64)',
                'everything errors from here down (except this)',
                '$(1 not)',
                '$(1 in 1)',
                '$(}',
                '$(")',
                '$(([{(([{(([{',
                '$("-" * 64)',
            ].forEach(runTest);
        </script>
    </body>
</html>
